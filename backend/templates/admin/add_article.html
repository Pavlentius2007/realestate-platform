<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å Sianoro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/admin/articles" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-arrow-left mr-2"></i>–ù–∞–∑–∞–¥ –∫ —Å—Ç–∞—Ç—å—è–º
                    </a>
                    <h1 class="text-2xl font-bold text-gray-900">‚úçÔ∏è –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</h1>
                </div>
                <div class="flex items-center space-x-3">
                    <button type="button" 
                            id="preview-btn"
                            class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        <i class="fas fa-eye mr-2"></i>–ü—Ä–µ–≤—å—é
                    </button>
                    <button form="article-form" 
                            type="submit" 
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-save mr-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-6 px-6">
        
        {% if error %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                {{ error }}
            </div>
        </div>
        {% endif %}

        <form id="article-form" method="POST" action="/admin/articles/add" enctype="multipart/form-data" class="space-y-6">
            
            <!-- Basic Info -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                            –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏ *
                        </label>
                        <input type="text" 
                               id="title" 
                               name="title" 
                               value="{{ title or '' }}"
                               required 
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏">
                    </div>
                    
                    <div>
                        <label for="slug" class="block text-sm font-medium text-gray-700 mb-2">
                            URL (slug) *
                        </label>
                        <input type="text" 
                               id="slug" 
                               name="slug" 
                               value="{{ slug or '' }}"
                               required 
                               pattern="[a-z0-9\-]+"
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="url-stati-bez-probelov">
                        <p class="text-xs text-gray-500 mt-1">
                            –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã
                        </p>
                    </div>
                </div>

                <!-- Featured Image Upload -->
                <div class="mt-6">
                    <label for="featured_image" class="block text-sm font-medium text-gray-700 mb-2">
                        üñºÔ∏è –ó–∞–≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    </label>
                    <div class="relative">
                        <input type="file" 
                               id="featured_image" 
                               name="featured_image" 
                               accept="image/*"
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               onchange="previewImage(this)">
                        <p class="text-xs text-gray-500 mt-1">
                            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1200x600px. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, WebP (–º–∞–∫—Å. 5MB)
                        </p>
                    </div>
                    <!-- Image Preview -->
                    <div id="image-preview" class="mt-4 hidden">
                        <img id="preview-img" src="" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä" class="max-w-full h-48 object-cover rounded-lg border">
                        <button type="button" onclick="removeImagePreview()" class="mt-2 text-sm text-red-600 hover:text-red-800">
                            <i class="fas fa-times mr-1"></i>–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        </button>
                    </div>
                </div>

                <div class="mt-6">
                    <label for="excerpt" class="block text-sm font-medium text-gray-700 mb-2">
                        –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                    </label>
                    <textarea id="excerpt" 
                              name="excerpt" 
                              rows="3"
                              class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                              placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ (–ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —Å—Ç–∞—Ç–µ–π)">{{ excerpt or '' }}</textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-2">
                            –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                        </label>
                        <select id="category" 
                                name="category" 
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="tips" {% if category == 'tips' %}selected{% endif %}>üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã</option>
                            <option value="buying" {% if category == 'buying' %}selected{% endif %}>üè† –ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</option>
                            <option value="renting" {% if category == 'renting' %}selected{% endif %}>üîë –ê—Ä–µ–Ω–¥–∞ –∂–∏–ª—å—è</option>
                            <option value="investment" {% if category == 'investment' %}selected{% endif %}>üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</option>
                            <option value="legal" {% if category == 'legal' %}selected{% endif %}>‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" 
                               id="published" 
                               name="published" 
                               value="true"
                               {% if published %}checked{% endif %}
                               class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="published" class="ml-3 text-sm font-medium text-gray-700">
                            ‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é —Å—Ä–∞–∑—É
                        </label>
                    </div>
                </div>
            </div>

            <!-- Content Editor -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">üìÑ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</h2>
                    <div class="flex items-center space-x-2">
                        <button type="button" 
                                id="toggle-editor"
                                class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg transition-colors">
                            <i class="fas fa-code mr-1"></i>Markdown
                        </button>
                        <a href="https://www.markdownguide.org/basic-syntax/" 
                           target="_blank"
                           class="text-sm text-blue-600 hover:text-blue-800">
                            <i class="fas fa-question-circle mr-1"></i>–°–ø—Ä–∞–≤–∫–∞
                        </a>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="editor-container">
                    <!-- Markdown Editor -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label class="text-sm font-medium text-gray-700">Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä</label>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <kbd class="px-2 py-1 bg-gray-100 rounded">Ctrl+S</kbd>
                                <span>–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</span>
                            </div>
                        </div>
                        <textarea id="content" 
                                  name="content" 
                                  rows="20"
                                  required
                                  class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown...">{{ content or '' }}</textarea>
                        
                        <!-- Markdown Toolbar -->
                        <div class="flex items-center space-x-2 text-sm">
                            <button type="button" onclick="insertMarkdown('**', '**')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded" title="–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" onclick="insertMarkdown('*', '*')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded" title="–ö—É—Ä—Å–∏–≤">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" onclick="insertMarkdown('## ', '')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                                <i class="fas fa-heading"></i>
                            </button>
                            <button type="button" onclick="insertMarkdown('- ', '')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded" title="–°–ø–∏—Å–æ–∫">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" onclick="insertMarkdown('[', '](url)')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded" title="–°—Å—ã–ª–∫–∞">
                                <i class="fas fa-link"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Live Preview -->
                    <div class="space-y-4">
                        <label class="text-sm font-medium text-gray-700">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</label>
                        <div id="preview" 
                             class="border border-gray-300 rounded-lg p-4 bg-gray-50 min-h-96 prose max-w-none">
                            <p class="text-gray-500 italic">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEO Settings -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">üîç SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="meta-title" class="block text-sm font-medium text-gray-700 mb-2">
                            Meta Title
                        </label>
                        <input type="text" 
                               id="meta-title" 
                               name="meta_title"
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è)">
                        <p class="text-xs text-gray-500 mt-1">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ 60 —Å–∏–º–≤–æ–ª–æ–≤</p>
                    </div>
                    
                    <div>
                        <label for="meta-description" class="block text-sm font-medium text-gray-700 mb-2">
                            Meta Description
                        </label>
                        <textarea id="meta-description" 
                                  name="meta_description"
                                  rows="3"
                                  class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è)"></textarea>
                        <p class="text-xs text-gray-500 mt-1">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ 160 —Å–∏–º–≤–æ–ª–æ–≤</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-between bg-white rounded-lg shadow p-6">
                <div class="flex items-center space-x-4">
                    <a href="/admin/articles" 
                       class="text-gray-600 hover:text-gray-900 font-medium">
                        <i class="fas fa-times mr-2"></i>–û—Ç–º–µ–Ω–∏—Ç—å
                    </a>
                </div>
                
                <div class="flex items-center space-x-3">
                    <button type="button" 
                            onclick="saveDraft()"
                            class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        <i class="fas fa-save mr-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫
                    </button>
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-check mr-2"></i>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex items-center justify-between p-4 border-b">
                <h3 class="text-lg font-semibold">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
                <button onclick="closePreview()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-preview-content" class="p-6 prose max-w-none">
                <!-- Preview content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
    // Auto-generate slug from title
    document.getElementById('title').addEventListener('input', function() {
        const title = this.value;
        const slug = title
            .toLowerCase()
            .replace(/[^a-z0-9\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '');
        
        if (!document.getElementById('slug').value) {
            document.getElementById('slug').value = slug;
        }
    });

    // Live preview
    const contentTextarea = document.getElementById('content');
    const previewDiv = document.getElementById('preview');

    contentTextarea.addEventListener('input', function() {
        const markdown = this.value;
        if (markdown.trim()) {
            previewDiv.innerHTML = marked.parse(markdown);
        } else {
            previewDiv.innerHTML = '<p class="text-gray-500 italic">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</p>';
        }
    });

    // Markdown toolbar functions
    function insertMarkdown(before, after) {
        const textarea = document.getElementById('content');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const text = textarea.value;
        const selectedText = text.substring(start, end);
        
        const newText = text.substring(0, start) + before + selectedText + after + text.substring(end);
        textarea.value = newText;
        
        // Update cursor position
        const newPosition = start + before.length + selectedText.length + after.length;
        textarea.setSelectionRange(newPosition, newPosition);
        textarea.focus();
        
        // Update preview
        textarea.dispatchEvent(new Event('input'));
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            document.getElementById('article-form').dispatchEvent(new Event('submit'));
        }
    });

    // Preview modal
    document.getElementById('preview-btn').addEventListener('click', function() {
        const content = document.getElementById('content').value;
        const title = document.getElementById('title').value;
        
        if (!content.trim()) {
            alert('–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏');
            return;
        }
        
        const modalContent = document.getElementById('modal-preview-content');
        modalContent.innerHTML = `
            <h1 class="text-3xl font-bold mb-4">${title || '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏'}</h1>
            ${marked.parse(content)}
        `;
        
        document.getElementById('preview-modal').classList.remove('hidden');
        document.getElementById('preview-modal').classList.add('flex');
    });

    function closePreview() {
        document.getElementById('preview-modal').classList.add('hidden');
        document.getElementById('preview-modal').classList.remove('flex');
    }

    // Save as draft
    function saveDraft() {
        document.getElementById('published').checked = false;
        document.getElementById('article-form').submit();
    }

    // Form validation
    document.getElementById('article-form').addEventListener('submit', function(e) {
        const title = document.getElementById('title').value.trim();
        const slug = document.getElementById('slug').value.trim();
        const content = document.getElementById('content').value.trim();
        
        if (!title || !slug || !content) {
            e.preventDefault();
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
            return;
        }
        
        // Validate slug format
        const slugPattern = /^[a-z0-9\-]+$/;
        if (!slugPattern.test(slug)) {
            e.preventDefault();
            alert('URL (slug) –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã');
            return;
        }
    });

    // Image preview functions
    function previewImage(input) {
        const file = input.files[0];
        const preview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        
        if (file) {
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB');
                input.value = '';
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    }
    
    function removeImagePreview() {
        document.getElementById('featured_image').value = '';
        document.getElementById('image-preview').classList.add('hidden');
        document.getElementById('preview-img').src = '';
    }

    // Auto-save to localStorage
    setInterval(function() {
        const formData = {
            title: document.getElementById('title').value,
            slug: document.getElementById('slug').value,
            excerpt: document.getElementById('excerpt').value,
            content: document.getElementById('content').value,
            category: document.getElementById('category').value
        };
        localStorage.setItem('article_draft', JSON.stringify(formData));
    }, 30000); // Save every 30 seconds

    // Restore from localStorage
    window.addEventListener('load', function() {
        const saved = localStorage.getItem('article_draft');
        if (saved && confirm('–ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?')) {
            const data = JSON.parse(saved);
            document.getElementById('title').value = data.title || '';
            document.getElementById('slug').value = data.slug || '';
            document.getElementById('excerpt').value = data.excerpt || '';
            document.getElementById('content').value = data.content || '';
            document.getElementById('category').value = data.category || 'tips';
            
            // Trigger preview update
            document.getElementById('content').dispatchEvent(new Event('input'));
        }
    });
    </script>
</body>
</html> 