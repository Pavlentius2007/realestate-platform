<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - Sianoro Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem 1rem;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-x: auto;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
        }

        .nav-link {
            border-radius: 10px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: var(--primary-gradient);
            color: white !important;
        }

        .nav-link.active {
            background: var(--primary-gradient);
            color: white !important;
        }

        .metric-card {
            background: linear-gradient(45deg, #f0f0f0, #ffffff);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: scale(1.02);
        }

        .metric-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-fill {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .table-analytics {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
        }

        .table-analytics th {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .export-btn {
            background: var(--success-gradient);
            border: none;
            border-radius: 10px;
            color: white;
            padding: 0.5rem 1.5rem;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: white;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="sidebar">
            <h3 class="text-center mb-4">
                <span style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    üè¢ Sianoro Admin
                </span>
            </h3>
            
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="/admin">
                        üìä –ì–ª–∞–≤–Ω–∞—è
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/properties">
                        üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/projects">
                        üèóÔ∏è –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/rental">
                        üìã –ê—Ä–µ–Ω–¥–∞
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/users">
                        üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/articles">
                        üì∞ –°—Ç–∞—Ç—å–∏
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/admin/analytics">
                        üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/reports">
                        üìã –û—Ç—á–µ—Ç—ã
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/logs">
                        üìã –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
                    </a>
                </li>
            </ul>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>üìà –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å</h2>
                <div>
                    <button class="export-btn me-2" onclick="exportToPDF()">
                        üìÑ –≠–∫—Å–ø–æ—Ä—Ç PDF
                    </button>
                    <button class="export-btn" onclick="exportToExcel()">
                        üìä –≠–∫—Å–ø–æ—Ä—Ç Excel
                    </button>
                </div>
            </div>

            {% if error %}
                <div class="alert alert-danger">
                    ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: {{ error }}
                </div>
            {% elif analytics %}
                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="metric-icon">üë•</div>
                            <div class="stats-number">{{ analytics.total_stats.users }}</div>
                            <div class="text-muted">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                            <small class="text-success">+{{ analytics.total_stats.new_users_month }} –∑–∞ –º–µ—Å—è—Ü</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="metric-icon">üè†</div>
                            <div class="stats-number">{{ analytics.total_stats.properties }}</div>
                            <div class="text-muted">–û–±—ä–µ–∫—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="metric-icon">üèóÔ∏è</div>
                            <div class="stats-number">{{ analytics.total_stats.projects }}</div>
                            <div class="text-muted">–ü—Ä–æ–µ–∫—Ç–æ–≤ –Ω–æ–≤–æ—Å—Ç—Ä–æ–µ–∫</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="metric-icon">üí∞</div>
                            <div class="stats-number">${{ "{:,.0f}".format(analytics.price_analysis.avg_price) }}</div>
                            <div class="text-muted">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
                        </div>
                    </div>
                </div>

                <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã -->
                <div class="row">
                    <!-- –¢—Ä–µ–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="col-md-8">
                        <div class="chart-card">
                            <h5>üìà –¢—Ä–µ–Ω–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π (6 –º–µ—Å—è—Ü–µ–≤)</h5>
                            <canvas id="userTrendChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <!-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="col-md-4">
                        <div class="chart-card">
                            <h5>üåç –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞</h5>
                            <canvas id="sourceChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- –¢–∏–ø—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
                    <div class="col-md-6">
                        <div class="chart-card">
                            <h5>üè† –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º —Å–¥–µ–ª–æ–∫</h5>
                            <canvas id="propertyChart" width="300" height="200"></canvas>
                        </div>
                    </div>

                    <!-- –¢–æ–ø –ª–æ–∫–∞—Ü–∏–π -->
                    <div class="col-md-6">
                        <div class="chart-card">
                            <h5>üìç –¢–æ–ø-10 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π</h5>
                            <div class="table-responsive">
                                <table class="table table-analytics">
                                    <thead>
                                        <tr>
                                            <th>–ì–æ—Ä–æ–¥</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                            <th>%</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% set total_locations = analytics.location_stats|sum(attribute='count') %}
                                        {% for location in analytics.location_stats[:10] %}
                                        <tr>
                                            <td>{{ location.city }}</td>
                                            <td>{{ location.count }}</td>
                                            <td>{{ "%.1f"|format((location.count / total_locations * 100) if total_locations > 0 else 0) }}%</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="chart-card">
                            <h5>üì± –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="metric-card">
                                        <div class="metric-icon">üìû</div>
                                        <div class="stats-number">{{ analytics.contact_stats.with_phone }}</div>
                                        <div class="text-muted">–° —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="metric-card">
                                        <div class="metric-icon">üí¨</div>
                                        <div class="stats-number">{{ analytics.contact_stats.with_telegram }}</div>
                                        <div class="text-muted">–° Telegram</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="metric-card">
                                        <div class="metric-icon">üì≤</div>
                                        <div class="stats-number">{{ analytics.contact_stats.with_whatsapp }}</div>
                                        <div class="text-muted">–° WhatsApp</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            {% else %}
                <div class="text-center py-5">
                    <div class="chart-card">
                        <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...</h5>
                        <p class="text-muted">–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function exportToPDF() {
            alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }

        function exportToExcel() {
            alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ Jinja2 —Ü–∏–∫–ª–æ–≤)
        document.addEventListener('DOMContentLoaded', function() {
            // –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
            initializeCharts();
        });

        function initializeCharts() {
            // –¢—Ä–µ–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
            const userTrendCtx = document.getElementById('userTrendChart');
            if (userTrendCtx) {
                new Chart(userTrendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['–Ø–Ω–≤ 2024', '–§–µ–≤ 2024', '–ú–∞—Ä 2024', '–ê–ø—Ä 2024', '–ú–∞–π 2024', '–ò—é–Ω 2024'],
                        datasets: [{
                            label: '–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                            data: [12, 19, 15, 25, 22, 30],
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (–¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
            const sourceCtx = document.getElementById('sourceChart');
            if (sourceCtx) {
                new Chart(sourceCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['–°–∞–π—Ç', 'Telegram', 'WhatsApp', '–†–µ–∫–ª–∞–º–∞'],
                        datasets: [{
                            data: [45, 25, 20, 10],
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(240, 147, 251, 0.8)',
                                'rgba(79, 172, 254, 0.8)',
                                'rgba(245, 87, 108, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // –¢–∏–ø—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (–¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
            const propertyCtx = document.getElementById('propertyChart');
            if (propertyCtx) {
                new Chart(propertyCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['–ü–æ–∫—É–ø–∫–∞', '–ê—Ä–µ–Ω–¥–∞'],
                        datasets: [{
                            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                            data: [65, 35],
                            backgroundColor: 'rgba(102, 126, 234, 0.8)'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html> 