{% extends 'base.html' %}
{% block content %}
<div class="max-w-3xl mx-auto py-10 px-4">
  <h1 class="text-3xl font-bold text-bluebrand mb-6 text-center">ü§ñ –ü–æ–¥–±–æ—Ä –∂–∏–ª—å—è –ø–æ –ò–ò</h1>
  <form id="ai-search-form" class="bg-white rounded-2xl shadow p-6 space-y-6" method="post">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">–ë—é–¥–∂–µ—Ç (‡∏ø)</label>
        <input type="number" name="budget" class="w-full border rounded-xl px-4 py-2" placeholder="–¥–æ 100 000" min="0">
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–ü–ª–æ—â–∞–¥—å (–º¬≤)</label>
        <div class="flex gap-2">
          <input type="number" name="area_from" class="w-full border rounded-xl px-4 py-2" placeholder="–æ—Ç" min="0">
          <input type="number" name="area_to" class="w-full border rounded-xl px-4 py-2" placeholder="–¥–æ" min="0">
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–†–∞–π–æ–Ω</label>
        <select name="district" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–æ–π</option>
          <option>–í–æ–Ω–≥–∞–º–∞—Ç</option>
          <option>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ü–∞—Ç—Ç–∞–π—è</option>
          <option>–í–æ—Å—Ç–æ—á–Ω–∞—è –ü–∞—Ç—Ç–∞–π—è</option>
          <option>–ù–∞–∫–ª—É–∞</option>
          <option>–ü—Ä–∞—Ç–∞–º–Ω–∞–∫</option>
          <option>–î–∂–æ–º—Ç—å–µ–Ω</option>
          <option>–ù–∞ –î–∂–æ–º—Ç—å–µ–Ω</option>
          <option>–Æ–≥</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">{{ _("forms.property_type") }}</label>
        <select name="property_type" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–æ–π</option>
          <option>–ö–æ–Ω–¥–æ</option>
          <option>–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã</option>
          <option>–í–∏–ª–ª–∞</option>
          <option>–¢–∞—É–Ω—Ö–∞—É—Å</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–°–ø–∞–ª–µ–Ω</label>
        <select name="bedrooms" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–æ–µ</option>
          <option>1+</option>
          <option>2+</option>
          <option>3+</option>
          <option>4+</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–≠—Ç–∞–∂ / –≠—Ç–∞–∂–Ω–æ—Å—Ç—å</label>
        <input type="text" name="floor" class="w-full border rounded-xl px-4 py-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ –≤—ã—à–µ 5, –Ω–µ –ø–µ—Ä–≤—ã–π –∏ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π">
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–ú–µ–±–ª–∏—Ä–æ–≤–∫–∞</label>
        <select name="furnished" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–∞—è</option>
          <option>–ü–æ–ª–Ω–æ—Å—Ç—å—é –º–µ–±–ª–∏—Ä–æ–≤–∞–Ω–∞</option>
          <option>–ß–∞—Å—Ç–∏—á–Ω–æ</option>
          <option>–ë–µ–∑ –º–µ–±–µ–ª–∏</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–í–∏–¥ –∏–∑ –æ–∫–Ω–∞</label>
        <select name="view" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–æ–π</option>
          <option>–ú–æ—Ä–µ</option>
          <option>–ì–æ—Ä–æ–¥</option>
          <option>–ì–æ—Ä—ã</option>
          <option>–°–∞–¥</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–£—Ä–æ–≤–µ–Ω—å –æ–±—ä–µ–∫—Ç–∞</label>
        <select name="level" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–æ–π</option>
          <option>–≠–∫–æ–Ω–æ–º</option>
          <option>–ö–æ–º—Ñ–æ—Ä—Ç</option>
          <option>–ë–∏–∑–Ω–µ—Å</option>
          <option>–õ—é–∫—Å</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–ü–∏—Ç–æ–º—Ü—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã</label>
        <select name="pets" class="w-full border rounded-xl px-4 py-2">
          <option value="">–ù–µ –≤–∞–∂–Ω–æ</option>
          <option>–î–∞</option>
          <option>–ù–µ—Ç</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–ë–∞—Å—Å–µ–π–Ω</label>
        <select name="pool" class="w-full border rounded-xl px-4 py-2">
          <option value="">–ù–µ –≤–∞–∂–Ω–æ</option>
          <option>–° –±–∞—Å—Å–µ–π–Ω–æ–º</option>
          <option>–ë–µ–∑ –±–∞—Å—Å–µ–π–Ω–∞</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞ / –í—Ç–æ—Ä–∏—á–∫–∞</label>
        <select name="new_or_secondary" class="w-full border rounded-xl px-4 py-2">
          <option value="">–õ—é–±–æ–π</option>
          <option>–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞</option>
          <option>–í—Ç–æ—Ä–∏—á–∫–∞</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">–¶–µ–ª—å –ø–æ–¥–±–æ—Ä–∞</label>
        <select name="purpose" class="w-full border rounded-xl px-4 py-2">
          <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
          <option>–¢—É—Ä–∏—Å—Ç—É</option>
          <option>–ù–∞ –ü–ú–ñ</option>
        </select>
      </div>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä—è–¥–æ–º</label>
      <div class="flex flex-wrap gap-4">
        <label class="inline-flex items-center"><input type="checkbox" name="infra_school" class="form-checkbox mr-2">–®–∫–æ–ª–∞</label>
        <label class="inline-flex items-center"><input type="checkbox" name="infra_beach" class="form-checkbox mr-2">–ü–ª—è–∂</label>
        <label class="inline-flex items-center"><input type="checkbox" name="infra_mall" class="form-checkbox mr-2">–¢–¶</label>
        <label class="inline-flex items-center"><input type="checkbox" name="infra_market" class="form-checkbox mr-2">–†—ã–Ω–æ–∫</label>
        <label class="inline-flex items-center"><input type="checkbox" name="infra_hospital" class="form-checkbox mr-2">–ì–æ—Å–ø–∏—Ç–∞–ª—å</label>
        <label class="inline-flex items-center"><input type="checkbox" name="infra_gym" class="form-checkbox mr-2">–°–ø–æ—Ä—Ç–∑–∞–ª</label>
      </div>
    </div>
    <div class="flex flex-wrap gap-4 justify-center pt-6">
      <button type="submit" class="bg-bluebrand hover:bg-bluebrand-dark text-white font-semibold px-8 py-3 rounded-2xl shadow-lg transition">–ü–æ–¥–æ–±—Ä–∞—Ç—å</button>
      <button type="button" class="bg-white border border-bluebrand text-bluebrand font-semibold px-8 py-3 rounded-2xl shadow-lg transition">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
      <button type="button" class="bg-blue-100 text-bluebrand font-semibold px-8 py-3 rounded-2xl shadow-lg transition">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–¥–±–æ—Ä</button>
      <button type="button" class="bg-blue-100 text-bluebrand font-semibold px-8 py-3 rounded-2xl shadow-lg transition">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–±–æ—Ä –Ω–∞ –ø–æ—á—Ç—É</button>
    </div>
  </form>
  <div id="ai-results" class="mt-10">
    {% if explanation %}
      <div class="bg-blue-50 border-l-4 border-bluebrand p-4 mb-6 text-bluebrand text-lg rounded">{{ explanation }}</div>
    {% endif %}
    {% if results is defined %}
      {% if results|length > 0 %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {% for property in results %}
            <div class="bg-white rounded-2xl shadow-md overflow-hidden border border-gray-100 transition hover:shadow-lg">
              <img src="/static/images/{{ property.preview_image or 'default.jpg' }}" alt="{{ property.title }}"
                   class="w-full h-48 object-cover">
              <div class="p-4 space-y-2">
                <div class="text-xl font-bold text-sber">‡∏ø {{ "{:,.0f}".format(property.price) }}</div>
                <h3 class="text-lg font-bold text-gray-800 truncate">{{ property.title }}</h3>
                <div class="text-gray-800 font-semibold text-sm truncate">üè¢ {{ property.condo_name or "‚Äì" }}</div>
                <div class="text-gray-500 text-sm truncate">üìç {{ property.district or "‚Äì" }}, {{ property.location or "‚Äì" }}</div>
                <div class="flex justify-between text-xs text-gray-600 mt-2">
                  <span>üèß {{ property.bedrooms or "‚Äì" }} —Å–ø–∞–ª—å–Ω.</span>
                  <span>üöª {{ property.bathrooms or "‚Äì" }} –≤–∞–Ω–Ω.</span>
                </div>
                <div class="flex justify-between text-xs text-gray-600">
                  <span>üìÄ {{ property.area or "‚Äì" }} –º¬≤</span>
                  <span>üè¢ {{ property.floor or "‚Äî" }} —ç—Ç–∞–∂</span>
                </div>
                <div class="pt-2 text-right">
                  <a href="/{{ lang }}/properties/{{ property.id }}" class="text-sm text-sber-dark font-medium underline">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center text-gray-500 text-lg py-8">–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.</div>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %} 