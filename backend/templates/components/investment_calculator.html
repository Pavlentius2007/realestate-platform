<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
<div id="investment-calculator-modal" class="fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-50 hidden">
  <div class="bg-white rounded-3xl shadow-2xl p-4 md:p-8 max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è -->
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl md:text-3xl font-bold font-heading text-gray-900">üí∞ {{ _("calculator.title") or "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" }}</h2>
      <button onclick="closeInvestmentCalculator()" class="text-gray-400 hover:text-gray-700 text-3xl font-light">&times;</button>
    </div>
    
    <div class="mb-6">
      <p class="text-lg text-gray-600">{{ _("calculator.subtitle") or "–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –≤ –¢–∞–∏–ª–∞–Ω–¥–µ" }}</p>
    </div>
    
    <!-- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ -->
    <div class="mb-6 p-4 bg-blue-50 rounded-xl">
      <h3 class="text-lg font-semibold mb-3 text-gray-800">üè† –ë—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:</h3>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <button onclick="applyPreset('studio')" class="bg-white hover:bg-blue-100 border border-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition text-sm">
          –°—Ç—É–¥–∏—è (25–º¬≤)
        </button>
        <button onclick="applyPreset('oneBR')" class="bg-white hover:bg-blue-100 border border-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition text-sm">
          1 —Å–ø–∞–ª—å–Ω—è (40–º¬≤)
        </button>
        <button onclick="applyPreset('twoBR')" class="bg-white hover:bg-blue-100 border border-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition text-sm">
          2 —Å–ø–∞–ª—å–Ω–∏ (65–º¬≤)
        </button>
      </div>
    </div>
    
    <!-- –í–∞–ª—é—Ç–∞ -->
    <div class="mb-6">
      <label class="block text-sm font-medium mb-2">{{ _("calculator.currency") or "–í–∞–ª—é—Ç–∞" }}</label>
      <select id="currency" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <option value="THB">THB (–±–∞—Ç)</option>
        <option value="USD">USD ($)</option>
        <option value="RUB">RUB (‚ÇΩ)</option>
        <option value="CNY">CNY (¬•)</option>
      </select>
      <span id="currency-rate" class="text-xs text-gray-500 mt-1 block"></span>
    </div>
    
    <!-- –í–≤–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
    <form id="investmentForm" class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.property_price") or "–°—Ç–æ–∏–º–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã" }}</label>
          <input type="number" id="price" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.area") or "–ü–ª–æ—â–∞–¥—å, –º¬≤" }}</label>
          <input type="number" id="area" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.deposit") or "–î–µ–ø–æ–∑–∏—Ç (THB –∏–ª–∏ %)" }}</label>
          <input type="number" id="deposit" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" value="100000">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.contract_payment") or "–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –ø–ª–∞—Ç—ë–∂ (%)" }}</label>
          <input type="number" id="contract" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" max="100" value="35">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.installment") or "–†–∞—Å—Å—Ä–æ—á–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–π–∫—É (%)" }}</label>
          <input type="number" id="installment" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" max="100" value="15">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.registration") or "–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ (% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏)" }}</label>
          <input type="number" id="registration" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" max="100" value="1.1">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.sinking_fund") or "Sinking Fund (–µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)" }}</label>
          <input type="number" id="sinking" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.maintenance_fee") or "–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–≤ –≥–æ–¥)" }}</label>
          <input type="number" id="maintenance" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.price_growth") or "–ü—Ä–æ–≥–Ω–æ–∑ —Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã (% –≤ –≥–æ–¥)" }}</label>
          <input type="number" id="growth" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" value="12">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">{{ _("calculator.construction_years") or "–°—Ä–æ–∫ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ (–ª–µ—Ç)" }}</label>
          <input type="number" id="years" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="1" value="3">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">{{ _("calculator.rental_yield") or "–î–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã (% –≤ –≥–æ–¥)" }}</label>
          <input type="number" id="rent_yield" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base" min="0" value="7">
        </div>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∏ -->
      <div class="flex flex-col sm:flex-row gap-4 pt-4">
        <button type="button" onclick="closeInvestmentCalculator()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-6 rounded-xl transition-colors text-sm md:text-base">
          {{ _("common.cancel") or "–û—Ç–º–µ–Ω–∞" }}
        </button>
        <button type="button" id="calculate-btn" class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors text-sm md:text-base">
          üí∞ {{ _("calculator.calculate") or "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" }}
        </button>
      </div>
    </form>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div id="calc-results" class="mt-8 hidden">
      <h3 class="text-xl font-semibold mb-4">{{ _("calculator.results") or "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞" }}</h3>
      
      <!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã -->
      <div class="mb-6 p-4 bg-gray-50 rounded-xl">
        <h4 class="text-lg font-medium mb-3 text-gray-800">üìà –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã</h4>
        <div class="bg-white rounded-lg p-4">
          <canvas id="price-chart" class="w-full" style="max-height: 250px;"></canvas>
        </div>
      </div>
      
      <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200">
          <div class="font-medium text-blue-800">{{ _("calculator.total_invested") or "–í—Å–µ–≥–æ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ" }}</div>
          <div id="result-invested" class="text-xl font-bold text-blue-900"></div>
        </div>
        <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-xl p-4 border border-green-200">
          <div class="font-medium text-green-800">{{ _("calculator.future_price") or "–ë—É–¥—É—â–∞—è —Ü–µ–Ω–∞ —á–µ—Ä–µ–∑" }} <span id="result-years"></span> {{ _("calculator.years") or "–ª–µ—Ç" }}</div>
          <div id="result-future-price" class="text-xl font-bold text-green-900"></div>
        </div>
        <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200">
          <div class="font-medium text-purple-800">{{ _("calculator.profit") or "–ü—Ä–∏–±—ã–ª—å (—Ä–æ—Å—Ç —Ü–µ–Ω—ã)" }}</div>
          <div id="result-profit" class="text-xl font-bold text-purple-900"></div>
        </div>
        <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-xl p-4 border border-orange-200">
          <div class="font-medium text-orange-800">{{ _("calculator.rental_income") or "–î–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã –∑–∞" }} <span id="result-years-rent"></span> {{ _("calculator.years") or "–ª–µ—Ç" }}</div>
          <div id="result-rent" class="text-xl font-bold text-orange-900"></div>
        </div>
      </div>
      
      <!-- ROI –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-gray-50 rounded-xl p-4">
          <div class="font-medium text-gray-700">{{ _("calculator.roi_year") or "–ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (ROI)" }}</div>
          <div id="result-roi-year" class="text-lg font-bold text-purple-600"></div>
        </div>
        <div class="bg-gray-50 rounded-xl p-4">
          <div class="font-medium text-gray-700">{{ _("calculator.roi_total") or "–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (ROI)" }}</div>
          <div id="result-roi-total" class="text-lg font-bold text-purple-600"></div>
        </div>
        <div class="bg-gray-50 rounded-xl p-4">
          <div class="font-medium text-gray-700">{{ _("calculator.price_per_sqm") or "–¶–µ–Ω–∞ –∑–∞ –º¬≤" }}</div>
          <div id="result-price-m2" class="text-lg font-bold text-gray-900"></div>
        </div>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
      <div class="flex justify-center">
        <button id="download-pdf" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-xl transition-colors flex items-center gap-2">
          üìÑ {{ _("calculator.download_pdf") or "–°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á—ë—Ç" }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ jsPDF –¥–ª—è PDF —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
function closeInvestmentCalculator() {
  const modal = document.getElementById('investment-calculator-modal');
  if (modal) {
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
  }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('investment-calculator-modal');
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closeInvestmentCalculator();
      }
    });
  }
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeInvestmentCalculator();
    }
  });
  
  // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å canvas –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
  function resizeCanvas() {
    const canvas = document.getElementById('price-chart');
    if (canvas) {
      const container = canvas.parentElement;
      canvas.width = container.offsetWidth - 32; // padding
      canvas.height = Math.min(250, window.innerWidth < 768 ? 200 : 250);
    }
  }
  
  window.addEventListener('resize', resizeCanvas);
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ canvas
  setTimeout(resizeCanvas, 100);
});
</script> 