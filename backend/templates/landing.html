{% extends 'base.html' %}
{% block content %}

<!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π hero-–±–ª–æ–∫ -->
<section class="relative w-full h-[380px] md:h-[420px] lg:h-[460px] flex items-center justify-center bg-cover bg-center" style="background-image: url('/static/img/hero-bg.jpg');">
  <div class="absolute inset-0 bg-black/40"></div>
  <div class="relative z-10 flex flex-col items-center justify-center w-full text-center px-4">
    <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold font-heading text-white mb-4 drop-shadow-lg">
      {{ _("site.title") }}
    </h1>
    <p class="text-lg md:text-xl lg:text-2xl text-white mb-8 drop-shadow max-w-2xl">
      {{ _("site.subtitle") }}
    </p>
  </div>
</section>

<!-- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
<section id="search-section" class="bg-white py-16">
  <div class="max-w-7xl mx-auto px-4">
    <div class="text-center mb-10">
      <h2 class="text-3xl md:text-4xl font-bold font-heading text-gray-900 mb-4">
        {{ _("search.title") }}
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        {{ _("search.subtitle") }}
      </p>
    </div>

    <!-- –¢–∞–±—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –ø–æ–∏—Å–∫–∞ -->
    <div class="bg-gray-50 rounded-3xl shadow-lg overflow-hidden">
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ç–∞–±–æ–≤ -->
      <div class="flex flex-wrap justify-center bg-white border-b border-gray-200">
        <button onclick="switchSearchTab('buy')" 
                class="search-tab active flex-1 min-w-0 px-4 py-4 text-center font-semibold transition-all hover:bg-blue-50" 
                data-tab="buy">
          <span class="text-lg">üè†</span>
          <div class="font-medium">{{ _("search.tabs.buy") }}</div>
          <div class="text-xs text-gray-500">{{ _("navigation.properties") }}</div>
        </button>
        
        <button onclick="switchSearchTab('rent')" 
                class="search-tab flex-1 min-w-0 px-4 py-4 text-center font-semibold transition-all hover:bg-blue-50" 
                data-tab="rent">
          <span class="text-lg">üèñÔ∏è</span>
          <div class="font-medium">{{ _("search.tabs.rent") }}</div>
          <div class="text-xs text-gray-500">{{ _("property.types.apartment") }}</div>
        </button>
        
        <button onclick="switchSearchTab('ai')" 
                class="search-tab flex-1 min-w-0 px-4 py-4 text-center font-semibold transition-all hover:bg-purple-50" 
                data-tab="ai">
          <span class="text-lg">ü§ñ</span>
          <div class="font-medium">{{ _("search.tabs.ai") }}</div>
          <div class="text-xs text-gray-500">–ò–ò-–ø–æ–¥–±–æ—Ä</div>
        </button>
        
        <button onclick="switchSearchTab('map')" 
                class="search-tab flex-1 min-w-0 px-4 py-4 text-center font-semibold transition-all hover:bg-green-50" 
                data-tab="map">
          <span class="text-lg">üó∫Ô∏è</span>
          <div class="font-medium">{{ _("search.tabs.map") }}</div>
          <div class="text-xs text-gray-500">–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–µ</div>
        </button>
      </div>

      <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤ -->
      
                                  <!-- –¢–∞–±: {{ _("navigation.buy_property") }} -->
      <div id="buy-tab" class="search-tab-content p-8 space-y-6" style="display: block;">
        <form class="space-y-6">
          <input type="hidden" name="deal_type" value="buy">
          
          <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏ -->
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üîç {{ _("forms.project_district") }}</label>
              <input type="text" name="query" placeholder="{{ _('search.placeholder') }}"
                     class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 font-modern" />
            </div>
            
            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-2">üè† {{ _("forms.property_type") }}</label>
              <select name="property_type" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 font-modern">
                <option value="">{{ _("property.types.any") }}</option>
                <option value="apartment">{{ _("property.types.apartment") }}</option>
                <option value="condo">{{ _("property.types.condo") }}</option>
                <option value="villa">{{ _("property.types.villa") }}</option>
                <option value="townhouse">{{ _("property.types.townhouse") }}</option>
                <option value="house">{{ _("property.types.house") }}</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üí∞ {{ _("property.budget") }}</label>
              <div class="flex gap-2">
                <input type="number" name="price_from" placeholder="{{ _('common.from') }}" step="0.1"
                       class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-blue-500 font-modern" />
                <input type="number" name="price_to" placeholder="{{ _('common.to') }}" step="0.1"
                       class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-blue-500 font-modern" />
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üõèÔ∏è {{ _("property.bedrooms") }}</label>
              <select name="bedrooms" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 font-modern">
                <option value="">{{ _("common.any_amount") }}</option>
                <option value="0">{{ _("common.studio") }}</option>
                <option value="1">{{ _("common.1_bedroom") }}</option>
                <option value="2">{{ _("common.2_bedrooms") }}</option>
                <option value="3">{{ _("common.3_bedrooms") }}</option>
              </select>
            </div>
          </div>
          
          <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ -->
          <div class="bg-blue-50 rounded-xl p-4">
            <div class="flex flex-wrap gap-4">
              <label class="flex items-center gap-2">
                <input type="checkbox" name="new_building" class="rounded border-gray-300 text-blue-600">
                <span class="text-sm font-medium">üèóÔ∏è {{ _("common.new_buildings_only") }}</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="sea_view" class="rounded border-gray-300 text-blue-600">
                <span class="text-sm font-medium">üåä {{ _("common.sea_view") }}</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="ready_to_move" class="rounded border-gray-300 text-blue-600">
                <span class="text-sm font-medium">‚úÖ {{ _("common.ready_to_move") }}</span>
              </label>
            </div>
          </div>
          
          <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –ø–æ–∏—Å–∫–µ -->
          <div class="mt-4 text-center">
            <div class="inline-flex items-center gap-2 text-sm text-gray-500 bg-blue-50 px-4 py-2 rounded-lg">
              <svg class="h-4 w-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>{{ _("common.search_auto") }}</span>
            </div>
          </div>

        </form>
      </div>
      
                                  <!-- –¢–∞–±: {{ _("navigation.rent_property") }} -->
      <div id="rent-tab" class="search-tab-content p-8 space-y-6" style="display: none;">
        <form class="space-y-6">
          <input type="hidden" name="deal_type" value="rent">
          
          <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∞—Ä–µ–Ω–¥—ã -->
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üîç {{ _("forms.project_district") }}</label>
              <input type="text" name="query" placeholder="{{ _('search.placeholder') }}"
                     class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-500 font-modern" />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üè† {{ _("forms.property_type") }}</label>
              <select name="property_type" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-500 font-modern">
                <option value="">{{ _("common.any_type") }}</option>
                <option value="apartment">{{ _("common.apartments") }}</option>
                <option value="condo">{{ _("common.condo") }}</option>
                <option value="villa">{{ _("common.villa") }}</option>
                <option value="studio">{{ _("common.studio_flat") }}</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üí∞ {{ _("common.budget_monthly") }}</label>
              <div class="flex gap-2">
                <input type="number" name="price_from" placeholder="{{ _('common.from') }}" step="5"
                       class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-green-500 font-modern" />
                <input type="number" name="price_to" placeholder="{{ _('common.to') }}" step="5"
                       class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-green-500 font-modern" />
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ {{ _("common.rental_period") }}</label>
              <select name="rental_period" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-500 font-modern">
                <option value="">{{ _("common.any_period") }}</option>
                <option value="short">{{ _("common.short_term") }}</option>
                <option value="medium">{{ _("common.medium_term") }}</option>
                <option value="long">{{ _("common.long_term") }}</option>
              </select>
            </div>
          </div>
          
          <!-- –£–¥–æ–±—Å—Ç–≤–∞ –¥–ª—è –∞—Ä–µ–Ω–¥—ã -->
          <div class="bg-green-50 rounded-xl p-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <label class="flex items-center gap-2">
                <input type="checkbox" name="furnished" class="rounded border-gray-300 text-green-600">
                <span class="text-sm">üõãÔ∏è {{ _("amenities.furnished") }}</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="pets_allowed" class="rounded border-gray-300 text-green-600">
                <span class="text-sm">üêï {{ _("amenities.pets_allowed") }}</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="pool" class="rounded border-gray-300 text-green-600">
                <span class="text-sm">üèä {{ _("amenities.pool") }}</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="gym" class="rounded border-gray-300 text-green-600">
                <span class="text-sm">üí™ {{ _("amenities.gym") }}</span>
              </label>
            </div>
          </div>
          
          <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –ø–æ–∏—Å–∫–µ -->
          <div class="mt-4 text-center">
            <div class="inline-flex items-center gap-2 text-sm text-gray-500 bg-green-50 px-4 py-2 rounded-lg">
              <svg class="h-4 w-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>{{ _("common.search_auto") }}</span>
            </div>
          </div>

        </form>
      </div>
      
      <!-- –¢–∞–±: –£–º–Ω—ã–π –ø–æ–∏—Å–∫ -->
      <div id="ai-tab" class="search-tab-content p-8 space-y-6" style="display: none;">
        <div class="text-center mb-6">
          <div class="text-6xl mb-4">ü§ñ</div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">{{ _("ai.title") }}</h3>
          <p class="text-gray-600">{{ _("ai.subtitle") }}</p>
        </div>
        
        <form class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("forms.deal_type") }}</label>
            <select name="search_type" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-purple-500 font-modern">
              <option value="buy">{{ _("search.tabs.buy") }}</option>
              <option value="rent">{{ _("search.tabs.rent") }}</option>
              <option value="new_builds">{{ _("navigation.new_builds") }}</option>
            </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("forms.budget_baht") }}</label>
              <div class="flex gap-2">
                <input type="number" name="budget_from" placeholder="{{ _('common.from') }}"
                       class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-purple-500 font-modern" />
                <input type="number" name="budget_to" placeholder="{{ _('common.to') }}"
                       class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-purple-500 font-modern" />
              </div>
            </div>
            
            <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("forms.district") }}</label>
            <select name="district" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-purple-500 font-modern">
              <option value="">{{ _("forms.any_district") }}</option>
              <option value="wongamat">{{ _("districts.wongamat") }}</option>
              <option value="central">{{ _("districts.central") }}</option>
              <option value="jomtien">{{ _("districts.jomtien") }}</option>
              <option value="pratumnak">{{ _("districts.pratumnak") }}</option>
            </select>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("ai.describe_wishes") }}</label>
                          <textarea name="description" rows="4" 
                        placeholder="{{ _('ai.placeholder') }}"
                      class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-purple-500 font-modern"></textarea>
          </div>
          
          <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
          <div class="text-center">
            <button type="button" onclick="aiSearch()" 
                    class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg transition-all">
              ü§ñ {{ _("ai.search_button") }}
            </button>
          </div>
        </form>
      </div>
      
      <!-- –¢–∞–±: –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–µ -->
      <div id="map-tab" class="search-tab-content p-8 space-y-6" style="display: none;">
        <div class="text-center mb-6">
          <div class="text-6xl mb-4">üó∫Ô∏è</div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">{{ _("map.title") }}</h3>
          <p class="text-gray-600">{{ _("map.subtitle") }}</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("forms.deal_type") }}</label>
            <select name="map_deal_type" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-500 font-modern">
              <option value="">{{ _("forms.show_all") }}</option>
              <option value="buy">{{ _("forms.sales_only") }}</option>
              <option value="rent">{{ _("forms.rental_only") }}</option>
              <option value="new_builds">{{ _("forms.new_builds_only") }}</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("forms.property_type") }}</label>
            <select name="map_property_type" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-500 font-modern">
              <option value="">{{ _("forms.all_types") }}</option>
              <option value="apartment">{{ _("property.types.apartment") }}</option>
              <option value="villa">{{ _("property.types.villa") }}</option>
              <option value="townhouse">{{ _("property.types.townhouse") }}</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">{{ _("property.budget") }}</label>
            <div class="flex gap-2">
              <input type="number" name="map_price_from" placeholder="–û—Ç" step="0.1"
                     class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-green-500 font-modern" />
              <input type="number" name="map_price_to" placeholder="–î–æ" step="0.1"
                     class="w-full border border-gray-300 rounded-xl px-3 py-3 focus:ring-2 focus:ring-green-500 font-modern" />
            </div>
          </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –∫–∞—Ä—Ç—É -->
        <div class="text-center">
          <button type="button" onclick="openMapSearch()" 
                  class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg transition-all">
            üó∫Ô∏è {{ _("map.open_button") }}
          </button>
        </div>
      </div>
    </div>

      <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div id="extra-filters" class="overflow-hidden transition-all duration-500 ease-in-out max-h-0">
        <div class="mt-8 p-6 bg-white rounded-2xl border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label class="flex flex-col">
                <span class="mb-2 text-sm font-medium text-gray-700">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</span>
                <input type="date" name="checkin_date" class="border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent font-modern" />
              </label>
            </div>
            
            <div class="md:col-span-2">
              <span class="block mb-3 text-sm font-medium text-gray-700">–£–¥–æ–±—Å—Ç–≤–∞</span>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <label class="inline-flex items-center">
                  <input type="checkbox" name="available_now" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">‚úÖ –°–≤–æ–±–æ–¥–Ω–æ —Å–µ–π—á–∞—Å</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="pets_allowed" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üêï {{ _("amenities.pets_allowed") }}</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="private_pool" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üèä {{ _("amenities.private_pool") }}</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="balcony" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üè† –ë–∞–ª–∫–æ–Ω</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="sea_view" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üåä {{ _("–í–∏–¥ –Ω–∞ –º–æ—Ä–µ") }}</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="parking" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üöó –ü–∞—Ä–∫–æ–≤–∫–∞</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="gym" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üí™ –§–∏—Ç–Ω–µ—Å-–∑–∞–ª</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="wifi" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üì∂ Wi-Fi</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="washing_machine" class="form-checkbox text-blue-600 rounded mr-2" />
                  <span class="text-sm">üß∫ –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
      <div id="results" class="mt-12">
        <div id="property-list">
          {% include 'components/property_cards.html' %}
        </div>
      </div>

      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div id="loading-indicator" class="text-center py-8 hidden">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <span class="text-gray-500 text-lg">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë" -->
      <div class="text-center pt-8">
        <button
          id="load-more"
          hx-get="/properties/filter?page=2"
          hx-target="#results"
          hx-include="#filter-form"
          hx-swap="afterend"
          class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-2xl shadow-lg transition-all transform hover:scale-105">
          –ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë –æ–±—ä–µ–∫—Ç—ã
        </button>
      </div>
    </form>
  </div>
</section>

<!-- –°–µ–∫—Ü–∏—è –∫–∞—Ä—Ç—ã -->
<section id="property-map" class="bg-gray-100 py-16">
  <div class="max-w-7xl mx-auto px-4">
    <div class="text-center mb-10">
      <h2 class="text-3xl md:text-4xl font-bold font-heading text-gray-900 mb-4">
        üìç –ö–∞—Ä—Ç–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        –ù–∞–π–¥–∏—Ç–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–µ –ü–∞—Ç—Ç–∞–π–∏
      </p>
    </div>
    
    <!-- –ö–∞—Ä—Ç–∞ -->
    <div class="bg-white rounded-3xl shadow-lg overflow-hidden">
      <div id="map-container" class="relative">
        <div id="map" class="w-full h-[500px] md:h-[600px]"></div>
        
        <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="absolute top-4 left-4 z-10">
          <div class="bg-white rounded-xl shadow-lg p-4 space-y-4">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="flex items-center justify-between">
              <h3 class="font-semibold text-gray-900">üîç –§–∏–ª—å—Ç—Ä—ã –∫–∞—Ä—Ç—ã</h3>
              <button onclick="toggleMapFilters()" id="filter-toggle-btn" class="text-gray-500 hover:text-gray-700">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã) -->
            <div class="space-y-3">
              <!-- –¢–∏–ø—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ -->
              <div class="space-y-2">
                                 <label class="flex items-center gap-2 cursor-pointer">
                   <input type="checkbox" id="filter-rent" class="property-filter rounded border-gray-300 text-blue-600 focus:ring-blue-500" data-type="rent" checked>
                   <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                   <span class="text-sm font-medium">–ê—Ä–µ–Ω–¥–∞</span>
                 </label>
                 
                 <label class="flex items-center gap-2 cursor-pointer">
                   <input type="checkbox" id="filter-sale" class="property-filter rounded border-gray-300 text-green-600 focus:ring-green-500" data-type="sale" checked>
                   <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                   <span class="text-sm font-medium">–ü—Ä–æ–¥–∞–∂–∞</span>
                 </label>
                 
                 <label class="flex items-center gap-2 cursor-pointer">
                   <input type="checkbox" id="filter-newbuilds" class="property-filter rounded border-gray-300 text-purple-600 focus:ring-purple-500" data-type="newbuilds" checked>
                   <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                   <span class="text-sm font-medium">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏</span>
                 </label>
              </div>
            </div>
            
            <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Å–∫—Ä—ã–≤–∞–µ–º—ã–µ) -->
            <div id="extended-map-filters" class="space-y-3 max-h-0 overflow-hidden transition-all duration-300">
              <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
              <div class="border-t pt-3 space-y-2">
                <button onclick="showOnlyNewBuilds()" 
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                  üèóÔ∏è {{ _("–¢–æ–ª—å–∫–æ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏") }}
                </button>
                
                <button onclick="openAiSearchModal()" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                  ü§ñ –ò–ò-–ø–æ–¥–±–æ—Ä
                </button>
                
                <button onclick="resetMapFilters()" 
                        class="w-full bg-gray-500 hover:bg-gray-600 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                  üîÑ –°–±—Ä–æ—Å–∏—Ç—å
                </button>
              </div>
              
              <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
              <div class="border-t pt-3 space-y-2">
                <div class="text-xs font-medium text-gray-700 mb-2">–¶–µ–Ω–∞ (–º–ª–Ω ‡∏ø):</div>
                <div class="flex gap-2">
                  <input type="number" id="price-from" placeholder="–û—Ç" 
                         class="w-full text-xs px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
                  <input type="number" id="price-to" placeholder="–î–æ" 
                         class="w-full text-xs px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
                </div>
                
                <div class="text-xs font-medium text-gray-700 mb-1 mt-3">–°–ø–∞–ª–µ–Ω:</div>
                <select id="bedrooms-filter" class="w-full text-xs px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
                                <option value="">{{ _("–õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ") }}</option>
              <option value="0">{{ _("–°—Ç—É–¥–∏—è") }}</option>
              <option value="1">{{ _("1 —Å–ø–∞–ª—å–Ω—è") }}</option>
              <option value="2">{{ _("2 —Å–ø–∞–ª—å–Ω–∏") }}</option>
              <option value="3">{{ _("3+ —Å–ø–∞–ª–µ–Ω") }}</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="absolute top-4 right-4 z-10 space-y-2">
          <button onclick="centerMap()" class="bg-white hover:bg-gray-50 p-3 rounded-xl shadow-lg transition-colors">
            üéØ –¶–µ–Ω—Ç—Ä
          </button>
          <button onclick="toggleSatellite()" class="bg-white hover:bg-gray-50 p-3 rounded-xl shadow-lg transition-colors">
            üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫
          </button>
        </div>
      </div>
    </div>
    
    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–∞–π–æ–Ω—ã -->
    <div class="mt-12 grid grid-cols-2 md:grid-cols-4 gap-4">
      <button onclick="goToDistrict('wongamat')" class="bg-white hover:bg-blue-50 p-4 rounded-xl shadow-lg transition-all text-left">
        <div class="font-semibold text-gray-900">–í–æ–Ω–≥–∞–º–∞—Ç</div>
        <div class="text-sm text-gray-500">–ü—Ä–µ–º–∏—É–º —Ä–∞–π–æ–Ω</div>
      </button>
      <button onclick="goToDistrict('central')" class="bg-white hover:bg-blue-50 p-4 rounded-xl shadow-lg transition-all text-left">
        <div class="font-semibold text-gray-900">–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ü–∞—Ç—Ç–∞–π—è</div>
        <div class="text-sm text-gray-500">–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä</div>
      </button>
      <button onclick="goToDistrict('jomtien')" class="bg-white hover:bg-blue-50 p-4 rounded-xl shadow-lg transition-all text-left">
        <div class="font-semibold text-gray-900">–î–∂–æ–º—Ç—å–µ–Ω</div>
        <div class="text-sm text-gray-500">–¢–∏—Ö–∏–π –ø–ª—è–∂</div>
      </button>
      <button onclick="goToDistrict('pratumnak')" class="bg-white hover:bg-blue-50 p-4 rounded-xl shadow-lg transition-all text-left">
        <div class="font-semibold text-gray-900">–ü—Ä–∞—Ç–∞–º–Ω–∞–∫</div>
        <div class="text-sm text-gray-500">–≠–ª–∏—Ç–Ω–∞—è –∑–æ–Ω–∞</div>
      </button>
    </div>
  </div>
</section>

<script>
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
  let filtersExpanded = false;
  function toggleFilters() {
    const filters = document.getElementById('extra-filters');
    filtersExpanded = !filtersExpanded;
    
    if (filtersExpanded) {
      filters.classList.remove('max-h-0');
      filters.classList.add('max-h-[1000px]');
    } else {
      filters.classList.add('max-h-0');
      filters.classList.remove('max-h-[1000px]');
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
  let map;
  let satelliteView = false;
  let allMarkers = {
    rent: [],
    sale: [],
    newbuilds: []
  };
  
  function initMap() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã Leaflet
    map = L.map('map').setView([12.9236, 100.8825], 12); // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ü–∞—Ç—Ç–∞–π–∏
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —Å–ª–æ—è
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤
    addSampleMarkers();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    initMapFilters();
  }
  
  function addSampleMarkers() {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∏–∫–æ–Ω–æ–∫
    const greenIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });
    
    const purpleIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });
    
    // –ú–∞—Ä–∫–µ—Ä—ã –∞—Ä–µ–Ω–¥—ã (—Å–∏–Ω–∏–µ)
    const rentMarker1 = L.marker([12.9336, 100.8825]).addTo(map)
      .bindPopup('<b>–ö–æ–Ω–¥–æ –¥–ª—è –∞—Ä–µ–Ω–¥—ã</b><br>25,000 ‡∏ø/–º–µ—Å—è—Ü<br>2 —Å–ø–∞–ª—å–Ω–∏, 80–º¬≤');
    
    const rentMarker2 = L.marker([12.9436, 100.8925]).addTo(map)
      .bindPopup('<b>–°—Ç—É–¥–∏—è —É –º–æ—Ä—è</b><br>18,000 ‡∏ø/–º–µ—Å—è—Ü<br>–°—Ç—É–¥–∏—è, 35–º¬≤');
    
    const rentMarker3 = L.marker([12.9136, 100.8725]).addTo(map)
      .bindPopup('<b>–í–∏–ª–ª–∞ —Å –±–∞—Å—Å–µ–π–Ω–æ–º</b><br>85,000 ‡∏ø/–º–µ—Å—è—Ü<br>4 —Å–ø–∞–ª—å–Ω–∏, 300–º¬≤');
    
    allMarkers.rent = [rentMarker1, rentMarker2, rentMarker3];
    
    // –ú–∞—Ä–∫–µ—Ä—ã –ø—Ä–æ–¥–∞–∂–∏ (–∑–µ–ª–µ–Ω—ã–µ)
    const saleMarker1 = L.marker([12.9136, 100.8925], {icon: greenIcon}).addTo(map)
      .bindPopup('<b>–ö–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</b><br>4,500,000 ‡∏ø<br>3 —Å–ø–∞–ª—å–Ω–∏, 120–º¬≤');
      
    const saleMarker2 = L.marker([12.9236, 100.8725], {icon: greenIcon}).addTo(map)
      .bindPopup('<b>–ü–µ–Ω—Ç—Ö–∞—É—Å</b><br>12,800,000 ‡∏ø<br>4 —Å–ø–∞–ª—å–Ω–∏, 250–º¬≤');
      
    const saleMarker3 = L.marker([12.9036, 100.8925], {icon: greenIcon}).addTo(map)
      .bindPopup('<b>–ö–æ–Ω–¥–æ –≤ —Ü–µ–Ω—Ç—Ä–µ</b><br>2,900,000 ‡∏ø<br>1 —Å–ø–∞–ª—å–Ω—è, 65–º¬≤');
    
    allMarkers.sale = [saleMarker1, saleMarker2, saleMarker3];
    
    // –ú–∞—Ä–∫–µ—Ä—ã –Ω–æ–≤–æ—Å—Ç—Ä–æ–µ–∫ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–µ)
    const newBuildMarker1 = L.marker([12.9036, 100.8725], {icon: purpleIcon}).addTo(map)
      .bindPopup('<b>–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞</b><br>PTY Residence<br>–æ—Ç 3,200,000 ‡∏ø');
      
    const newBuildMarker2 = L.marker([12.9536, 100.8825], {icon: purpleIcon}).addTo(map)
      .bindPopup('<b>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</b><br>Zenith Tower<br>–æ—Ç 5,500,000 ‡∏ø');
      
    const newBuildMarker3 = L.marker([12.8936, 100.8625], {icon: purpleIcon}).addTo(map)
      .bindPopup('<b>–°—Ç—Ä–æ–∏—Ç—Å—è</b><br>Ocean View<br>–æ—Ç 2,800,000 ‡∏ø');
    
    allMarkers.newbuilds = [newBuildMarker1, newBuildMarker2, newBuildMarker3];
    
    // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–≤–æ–≥–æ popup
    rentMarker1.openPopup();
  }
  
  function centerMap() {
    map.setView([12.9236, 100.8825], 12);
  }
  
  function toggleSatellite() {
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ–±—ã—á–Ω—ã–º –∏ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã–º –≤–∏–¥–æ–º
    if (!satelliteView) {
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles ¬© Esri'
      }).addTo(map);
      satelliteView = true;
    } else {
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);
      satelliteView = false;
    }
  }
  
  function goToDistrict(district) {
    const districts = {
      'wongamat': [12.9536, 100.8725],
      'central': [12.9236, 100.8825],
      'jomtien': [12.8736, 100.8925],
      'pratumnak': [12.9036, 100.8825]
    };
    
    if (districts[district]) {
      map.setView(districts[district], 14);
    }
  }
  
  // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –§–ò–õ–¨–¢–†–û–í –ö–ê–†–¢–´ ===
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  function initMapFilters() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    document.querySelectorAll('.property-filter').forEach(checkbox => {
      checkbox.addEventListener('change', updateMapMarkers);
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
    document.getElementById('price-from').addEventListener('input', updateMapMarkers);
    document.getElementById('price-to').addEventListener('input', updateMapMarkers);
    document.getElementById('bedrooms-filter').addEventListener('change', updateMapMarkers);
  }
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
  function toggleMapFilters() {
    const filtersPanel = document.getElementById('extended-map-filters');
    const toggleBtn = document.getElementById('filter-toggle-btn');
    
    if (filtersPanel.style.maxHeight === '0px' || !filtersPanel.style.maxHeight) {
      filtersPanel.style.maxHeight = '400px';
      toggleBtn.style.transform = 'rotate(180deg)';
    } else {
      filtersPanel.style.maxHeight = '0px';
      toggleBtn.style.transform = 'rotate(0deg)';
    }
  }
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  function updateMapMarkers() {
    const filters = {
      rent: document.getElementById('filter-rent').checked,
      sale: document.getElementById('filter-sale').checked,
      newbuilds: document.getElementById('filter-newbuilds').checked
    };
    
    // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–æ —Ç–∏–ø–∞–º
    Object.keys(allMarkers).forEach(type => {
      allMarkers[type].forEach(marker => {
        if (filters[type]) {
          marker.addTo(map);
        } else {
          map.removeLayer(marker);
        }
      });
    });
  }
  
  // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏
  function showOnlyNewBuilds() {
    // –°–Ω–∏–º–∞–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã
    document.getElementById('filter-rent').checked = false;
    document.getElementById('filter-sale').checked = false;
    document.getElementById('filter-newbuilds').checked = true;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
    updateMapMarkers();
    
    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞—Ö
    if (allMarkers.newbuilds.length > 0) {
      const group = new L.featureGroup(allMarkers.newbuilds);
      map.fitBounds(group.getBounds().pad(0.1));
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showMapNotification('üèóÔ∏è –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏', 'purple');
  }
  
  // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
  function resetMapFilters() {
    // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã
    document.getElementById('filter-rent').checked = true;
    document.getElementById('filter-sale').checked = true;
    document.getElementById('filter-newbuilds').checked = true;
    
    // –û—á–∏—â–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    document.getElementById('price-from').value = '';
    document.getElementById('price-to').value = '';
    document.getElementById('bedrooms-filter').value = '';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
    updateMapMarkers();
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞—Ä—Ç—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
    map.setView([12.9236, 100.8825], 12);
    
    showMapNotification('üîÑ –§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã', 'gray');
  }
  
  // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –∫–∞—Ä—Ç–µ
  function showMapNotification(message, color = 'blue') {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const notification = document.createElement('div');
    notification.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transition-all duration-300`;
    
    // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
    const colors = {
      purple: 'bg-purple-600',
      gray: 'bg-gray-600',
      blue: 'bg-blue-600',
      green: 'bg-green-600'
    };
    notification.classList.add(colors[color] || colors.blue);
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    setTimeout(() => {
      notification.style.opacity = '1';
      notification.style.transform = 'translate(-50%, 0)';
    }, 100);
    
    // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      notification.style.opacity = '0';
      notification.style.transform = 'translate(-50%, -20px)';
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 300);
    }, 3000);
  }
  
  // === –ö–û–ù–ï–¶ –§–£–ù–ö–¶–ò–ô –§–ò–õ–¨–¢–†–û–í ===
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', function() {
    initMap();
  });
  
  // === –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê ===
  
  // –°–∫—Ä–æ–ª–ª –∫ —Å–µ–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞
  function scrollToSearch() {
    document.getElementById('search-section').scrollIntoView({ 
      behavior: 'smooth' 
    });
  }
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏ –ø–æ–∏—Å–∫–∞
  function switchSearchTab(tabName) {
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('.search-tab').forEach(tab => {
      tab.classList.remove('active', 'bg-blue-100', 'bg-green-100', 'bg-purple-100', 'text-blue-700', 'text-green-700', 'text-purple-700');
      tab.classList.add('text-gray-600');
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.search-tab-content').forEach(content => {
      content.style.display = 'none';
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
    const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
    const activeContent = document.getElementById(`${tabName}-tab`);
    
    if (activeTab && activeContent) {
      activeTab.classList.add('active');
      activeTab.classList.remove('text-gray-600');
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–±–∞
      if (tabName === 'buy') {
        activeTab.classList.add('bg-blue-100', 'text-blue-700');
      } else if (tabName === 'rent') {
        activeTab.classList.add('bg-green-100', 'text-green-700');
      } else if (tabName === 'ai') {
        activeTab.classList.add('bg-purple-100', 'text-purple-700');
      } else if (tabName === 'map') {
        activeTab.classList.add('bg-green-100', 'text-green-700');
      }
      
      activeContent.style.display = 'block';
    }
  }
  
  // –ü–æ–∏—Å–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
  function searchProperties(dealType) {
    const form = document.querySelector(`#${dealType}-tab form`);
    if (!form) return;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    showLoadingIndicator();
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    const formData = new FormData(form);
    const params = new URLSearchParams();
    
    for (let [key, value] of formData.entries()) {
      if (value.trim()) {
        params.append(key, value);
      }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø —Å–¥–µ–ª–∫–∏
    params.set('deal_type', dealType);
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    window.location.href = `/{{ lang }}/properties?${params.toString()}`;
  }
  
  // –ò–ò-–ø–æ–∏—Å–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
  function aiSearch() {
    const form = document.querySelector('#ai-tab form');
    if (!form) return;
    
    const description = form.querySelector('[name="description"]').value;
    const searchType = form.querySelector('[name="search_type"]').value;
    const budgetFrom = form.querySelector('[name="budget_from"]').value;
    const budgetTo = form.querySelector('[name="budget_to"]').value;
    const district = form.querySelector('[name="district"]').value;
    
    if (!description.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è');
      return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    showLoadingIndicator();
    
    // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ò–ò-–ø–æ–∏—Å–∫–∞
    const params = new URLSearchParams({
      ai_search: 'true',
      description: description,
      deal_type: searchType,
      budget_from: budgetFrom || '',
      budget_to: budgetTo || '',
      district: district || ''
    });
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ò–ò-–ø–æ–∏—Å–∫–∞
    window.location.href = `/{{ lang }}/ai-search?${params.toString()}`;
  }
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
  function openMapSearch() {
    const form = document.querySelector('#map-tab form');
    if (!form) return;
    
    const dealType = form.querySelector('[name="map_deal_type"]').value;
    const propertyType = form.querySelector('[name="map_property_type"]').value;
    const priceFrom = form.querySelector('[name="map_price_from"]').value;
    const priceTo = form.querySelector('[name="map_price_to"]').value;
    
    // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    const params = new URLSearchParams({
      view: 'map',
      deal_type: dealType || '',
      property_type: propertyType || '',
      price_from: priceFrom || '',
      price_to: priceTo || ''
    });
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ä—Ç—É
    window.location.href = `/{{ lang }}/properties/map?${params.toString()}`;
  }
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ò–ò-–ø–æ–∏—Å–∫–∞
  function openAiSearchModal() {
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ç–∞–± –ò–ò-–ø–æ–∏—Å–∫–∞
    switchSearchTab('ai');
    
    // –°–∫—Ä–æ–ª–ª–∏–º –∫ —Å–µ–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞
    scrollToSearch();
    
    // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è
    setTimeout(() => {
      const descriptionField = document.querySelector('#ai-tab textarea[name="description"]');
      if (descriptionField) {
        descriptionField.focus();
      }
    }, 500);
  }
  
  // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
  function showLoadingIndicator() {
    const indicator = document.getElementById('loading-indicator');
    if (indicator) {
      indicator.classList.remove('hidden');
    }
  }
  
  // –°–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
  function hideLoadingIndicator() {
    const indicator = document.getElementById('loading-indicator');
    if (indicator) {
      indicator.classList.add('hidden');
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', function() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞–± –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    switchSearchTab('buy');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    hideLoadingIndicator();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    initAutoSearch();
  });
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  function initAutoSearch() {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã –ø–æ–∏—Å–∫–∞
    const searchForms = document.querySelectorAll('#buy-tab form, #rent-tab form');
    
    searchForms.forEach((form, index) => {
      const dealType = index === 0 ? 'buy' : 'rent';
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
      const inputs = form.querySelectorAll('input, select');
      inputs.forEach(input => {
        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
        if (input.type === 'text' || input.type === 'number') {
          let timeout;
          input.addEventListener('input', function() {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
              if (hasValidSearchParams(form)) {
                searchProperties(dealType);
              }
            }, 1000); // –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–≤–æ–¥–∞
          });
        }
        
        // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–µ–ª–µ–∫—Ç–æ–≤ –∏ —á–µ–∫–±–æ–∫—Å–æ–≤
        if (input.type === 'select-one' || input.type === 'checkbox') {
          input.addEventListener('change', function() {
            if (hasValidSearchParams(form)) {
              searchProperties(dealType);
            }
          });
        }
      });
    });
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–∏—Å–∫–∞
  function hasValidSearchParams(form) {
    const formData = new FormData(form);
    let hasParams = false;
    
    for (let [key, value] of formData.entries()) {
      if (key !== 'deal_type' && value.trim()) {
        hasParams = true;
        break;
      }
    }
    
    return hasParams;
  }
</script>
{% endblock %}
