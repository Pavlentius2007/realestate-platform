{% extends "base.html" %}

{% block title %}{{ _('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ') }}{% endblock %}

{% block head %}
  <meta name="description" content="{{ _(property.title) }} ‚Äì {{ _(property.description[:120]) }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
{% endblock %}

{% block content %}
<main class="max-w-7xl mx-auto px-4 py-6">
  <nav class="text-sm text-gray-600 mb-4">
    <a href="/{{ lang }}" class="hover:underline">–ì–ª–∞–≤–Ω–∞—è</a> ‚Ä∫ 
    <a href="/{{ lang }}/properties?deal_type={{ property.property_type }}" class="hover:underline">
      {% if property.property_type == 'rent' %}–°–Ω—è—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É{% else %}–ö—É–ø–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É{% endif %}
    </a>
    ‚Ä∫ <span>{{ property.title }}</span>
  </nav>

  <h1 class="text-2xl font-bold mb-1">{{ property.title }}</h1>
  <p class="text-blue-600 text-sm mb-4">üìç {{ property.location }}, {{ property.district }}</p>

  <div class="grid md:grid-cols-3 gap-6">
    <div class="md:col-span-2">
      <div class="swiper rounded overflow-hidden shadow">
        <div class="swiper-wrapper">
          {% if property.images %}
            {% for img in property.images if img.image_url %}
              <div class="swiper-slide">
                <img src="{{ img.image_url }}" class="w-full h-80 object-cover" />
              </div>
            {% endfor %}
          {% else %}
            <div class="swiper-slide">
              <div class="w-full h-80 bg-gray-100 flex items-center justify-center text-gray-500 text-sm">
                {{ _('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π') }}
              </div>
            </div>
          {% endif %}
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
      </div>

      <div class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm text-center">
        <div><i class="fas fa-bed text-blue-500 text-2xl block mx-auto"></i><span class="font-bold block">{{ property.bedrooms }}</span>–°–ø–∞–ª—å–Ω–∏</div>
        <div><i class="fas fa-bath text-blue-500 text-2xl block mx-auto"></i><span class="font-bold block">{{ property.bathrooms }}</span>–í–∞–Ω–Ω—ã–µ</div>
        <div><i class="fas fa-ruler-combined text-blue-500 text-2xl block mx-auto"></i><span class="font-bold block">{{ property.area }} –º¬≤</span>–ü–ª–æ—â–∞–¥—å</div>
        <div><i class="fas fa-layer-group text-blue-500 text-2xl block mx-auto"></i><span class="font-bold block">{{ property.floor }}</span>–≠—Ç–∞–∂</div>
      </div>

      <!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div class="mt-6 border-t pt-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
          <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h4 class="font-semibold text-gray-700 mb-3">üè† –û—Å–Ω–æ–≤–Ω–æ–µ</h4>
            <div class="space-y-2">
              <p><strong>ID:</strong> #{{ property.id }}</p>
              {% if property.property_type %}
                <p><strong>–¢–∏–ø:</strong> 
                  {% if property.property_type == 'apartment' %}üè¢ –ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
                  {% elif property.property_type == 'condo' %}üèóÔ∏è –ö–æ–Ω–¥–æ–º–∏–Ω–∏—É–º
                  {% elif property.property_type == 'villa' %}üèñÔ∏è –í–∏–ª–ª–∞
                  {% elif property.property_type == 'townhouse' %}üèòÔ∏è –¢–∞—É–Ω—Ö–∞—É—Å
                  {% elif property.property_type == 'house' %}üè† –î–æ–º
                  {% elif property.property_type == 'studio' %}üè® –°—Ç—É–¥–∏—è
                  {% else %}{{ property.property_type }}
                  {% endif %}
                </p>
              {% endif %}
              {% if property.status %}
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                  {% if property.status == 'available' %}‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω
                  {% elif property.status == 'rented' %}üè† –°–¥–∞–Ω
                  {% elif property.status == 'pending' %}‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                  {% elif property.status == 'maintenance' %}üîß –ù–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
                  {% else %}{{ property.status }}
                  {% endif %}
                </p>
              {% endif %}
              {% if property.condo_name %}
                <p><strong>–ü—Ä–æ–µ–∫—Ç:</strong> {{ property.condo_name }}</p>
              {% endif %}
              {% if property.is_new_building %}
                <p><strong>üèóÔ∏è –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞</strong></p>
              {% endif %}
            </div>
          </div>

          <!-- –¶–µ–Ω–∞ –∏ —É—Å–ª–æ–≤–∏—è -->
          <div class="bg-blue-50 rounded-lg p-4">
            <h4 class="font-semibold text-blue-700 mb-3">üí∞ –¶–µ–Ω–∞ –∏ —É—Å–ª–æ–≤–∏—è</h4>
            <div class="space-y-2">
              <p><strong>–¶–µ–Ω–∞:</strong> <span class="text-blue-600 font-bold">‡∏ø{{ property.price }}</span></p>
              {% if property.old_price and property.old_price > property.price %}
                <p><strong>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞:</strong> <span class="text-gray-500 line-through">‡∏ø{{ property.old_price }}</span></p>
              {% endif %}
              {% if property.price_period %}
                <p><strong>–ü–µ—Ä–∏–æ–¥ –æ–ø–ª–∞—Ç—ã:</strong> 
                  {% if property.price_period == 'month' %}üìÖ –≤ –º–µ—Å—è—Ü
                  {% elif property.price_period == 'day' %}üåÖ –≤ –¥–µ–Ω—å
                  {% elif property.price_period == 'year' %}üìÜ –≤ –≥–æ–¥
                  {% elif property.price_period == 'week' %}üìä –≤ –Ω–µ–¥–µ–ª—é
                  {% else %}{{ property.price_period }}
                  {% endif %}
                </p>
              {% endif %}
              {% if property.furnished %}
                <p><strong>–ú–µ–±–ª–∏—Ä–æ–≤–∫–∞:</strong> {{ property.furnished }}</p>
              {% endif %}
            </div>
          </div>

          <!-- –†–∞–∑–º–µ—Ä—ã -->
          <div class="bg-green-50 rounded-lg p-4">
            <h4 class="font-semibold text-green-700 mb-3">üìê –†–∞–∑–º–µ—Ä—ã</h4>
            <div class="space-y-2">
              {% if property.area %}
                <p><strong>–ü–ª–æ—â–∞–¥—å:</strong> {{ property.area }} –º¬≤</p>
              {% endif %}
              {% if property.land_area %}
                <p><strong>–ü–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞:</strong> {{ property.land_area }} –º¬≤</p>
              {% endif %}
              {% if property.floor %}
                <p><strong>–≠—Ç–∞–∂:</strong> {{ property.floor }}</p>
              {% endif %}
              {% if property.bedrooms is not none %}
                <p><strong>–°–ø–∞–ª–µ–Ω:</strong> {{ property.bedrooms }}</p>
              {% endif %}
              {% if property.bathrooms is not none %}
                <p><strong>–í–∞–Ω–Ω—ã—Ö:</strong> {{ property.bathrooms }}</p>
              {% endif %}
            </div>
          </div>

          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          {% if property.published_at or property.description %}
          <div class="bg-purple-50 rounded-lg p-4 md:col-span-2 lg:col-span-3">
            <h4 class="font-semibold text-purple-700 mb-3">‚ÑπÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h4>
            <div class="space-y-2">
              {% if property.published_at %}
                <p><strong>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong> {{ property.published_at }}</p>
              {% endif %}
              {% if property.description %}
                <div>
                  <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                  <p class="mt-2 text-gray-700 leading-relaxed">{{ property.description }}</p>
                </div>
              {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      {% if property.features %}
      <div class="mt-6">
        <h2 class="text-lg font-semibold mb-2">–û–±—â–∏–µ –£–¥–æ–±—Å—Ç–≤–∞</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 text-sm text-gray-700">
          {% for feature in property.features %}
            <div class="flex items-center gap-2">
              {% if "—Å—Ç–∏—Ä–∞–ª—å–Ω–∞—è" in feature|lower %}
                <i class="fas fa-soap text-blue-400"></i>
              {% elif "–±–∞–ª–∫–æ–Ω" in feature|lower %}
                <i class="fas fa-door-open text-blue-400"></i>
              {% elif "–∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä" in feature|lower %}
                <i class="fas fa-snowflake text-blue-400"></i>
              {% elif "wi-fi" in feature|lower %}
                <i class="fas fa-wifi text-blue-400"></i>
              {% elif "—Å–ø–æ—Ä—Ç" in feature|lower %}
                <i class="fas fa-dumbbell text-blue-400"></i>
              {% elif "–ø–∞—Ä–∫–∏–Ω–≥" in feature|lower %}
                <i class="fas fa-car text-blue-400"></i>
              {% elif "–±–∞—Å—Å–µ–π–Ω" in feature|lower %}
                <i class="fas fa-water-ladder text-blue-400"></i>
              {% elif "–æ—Ö—Ä–∞–Ω–∞" in feature|lower %}
                <i class="fas fa-shield-alt text-blue-400"></i>
              {% elif "—Å–∞–¥" in feature|lower %}
                <i class="fas fa-leaf text-blue-400"></i>
              {% else %}
                <i class="fas fa-check text-blue-400"></i>
              {% endif %}
              <span>{{ feature.strip() }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if property.lat and property.lng %}
      <div class="mt-10">
        <h2 class="text-lg font-semibold mb-2">–ö–∞—Ä—Ç–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è</h2>
        <div class="w-full h-96 rounded shadow">
          <div id="detail-map" class="w-full h-full rounded"></div>
        </div>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script type="text/javascript">
          document.addEventListener('DOMContentLoaded', function() {
            var detailMap = L.map('detail-map').setView([{{ property.lat }}, {{ property.lng }}], 15);
            L.tileLayer('{% raw %}https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png{% endraw %}', {
              attribution: '&copy; OpenStreetMap'
            }).addTo(detailMap);
            L.marker([{{ property.lat }}, {{ property.lng }}]).addTo(detailMap).bindPopup("{{ property.title }}").openPopup();
          });
        </script>
      </div>
      {% endif %}
    </div>

    <aside class="space-y-4">
      <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
      <div class="border p-4 rounded-lg shadow bg-white">
        <button id="favoriteBtn" onclick="toggleFavorite({{ property.id }})" 
                class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
          <svg id="heartIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
          </svg>
          <span id="favoriteText">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </button>
        <div class="text-xs text-gray-500 text-center mt-2">
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        </div>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="border p-4 rounded-lg shadow bg-white">
        <h3 class="text-lg font-semibold mb-3">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        <div class="space-y-2">
          <button onclick="shareProperty()" 
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
            </svg>
            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
          </button>
          
          <a href="/ru/favorites" 
             class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 block text-center">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
            </svg>
            ‚ù§Ô∏è –ú–æ–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
          </a>
          
          <button onclick="contactWhatsApp()" 
                  class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.097"/>
            </svg>
            üí¨ WhatsApp
          </button>
        </div>
      </div>

      <!-- –§–æ—Ä–º–∞ —Å–≤—è–∑–∏ -->
      <div class="border p-4 rounded-lg shadow bg-white">
        <h2 class="text-lg font-semibold mb-2">üìû –£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ</h2>
        <p class="text-xs text-gray-500 mb-2">–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏ –º—ã –ø—Ä–∏—à–ª—ë–º –≤–∞–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–µ</p>
        <form method="post" action="/callback" class="space-y-2">
          <input type="text" name="name" placeholder="–ò–º—è" class="border p-2 w-full rounded" required>
          <div class="flex gap-2">
            <div class="flex items-center border rounded px-2"><span class="text-sm">üáπüá≠ +66</span></div>
            <input type="tel" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" class="border p-2 w-full rounded" required>
          </div>
          <textarea name="message" class="border p-2 w-full rounded text-sm" rows="2" placeholder="–≠—Ç–æ –∂–∏–ª—å—ë –µ—â—ë –¥–æ—Å—Ç—É–ø–Ω–æ? –ü—Ä–∏—à–ª–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é."></textarea>
          <button class="bg-blue-600 text-white px-4 py-2 rounded w-full hover:bg-blue-700">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
        <div class="text-center text-sm mt-2 font-semibold text-gray-800">
          üìû +66 98 264 9201
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- JavaScript –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω—ã–º –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π -->
<script>
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
let isInFavorites = false;
let propertyId = {{ property.id }};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  checkFavoriteStatus();
});

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
async function checkFavoriteStatus() {
  try {
    const response = await fetch(`/ru/favorites/check/${propertyId}`);
    const data = await response.json();
    
    isInFavorites = data.in_favorites;
    updateFavoriteButton();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
  }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
async function toggleFavorite(propertyId) {
  const btn = document.getElementById('favoriteBtn');
  btn.disabled = true;
  
  try {
    const url = isInFavorites 
      ? `/ru/favorites/remove/${propertyId}`
      : `/ru/favorites/add/${propertyId}`;
    
    const method = isInFavorites ? 'DELETE' : 'POST';
    
    const response = await fetch(url, {
      method: method,
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const data = await response.json();
    
    if (data.success || response.ok) {
      isInFavorites = data.in_favorites;
      updateFavoriteButton();
      showNotification(data.message, data.success ? 'success' : 'info');
    } else {
      showNotification(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'error');
    }
  } catch (error) {
    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'error');
  } finally {
    btn.disabled = false;
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –∫–Ω–æ–ø–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
function updateFavoriteButton() {
  const btn = document.getElementById('favoriteBtn');
  const text = document.getElementById('favoriteText');
  const icon = document.getElementById('heartIcon');
  
  if (isInFavorites) {
    btn.className = 'w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2';
    text.textContent = '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º ‚úì';
    icon.style.fill = 'currentColor';
  } else {
    btn.className = 'w-full bg-gray-600 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2';
    text.textContent = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
    icon.style.fill = 'none';
    icon.style.stroke = 'currentColor';
    icon.style.strokeWidth = '1.5';
  }
}

// –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –æ–±—ä–µ–∫—Ç–æ–º
function shareProperty() {
  const title = '{{ property.title|e }}';
  const url = window.location.href;
  
  if (navigator.share) {
    navigator.share({
      title: title,
      text: `–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: ${title}`,
      url: url
    });
  } else {
    // –ö–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    navigator.clipboard.writeText(url).then(() => {
      showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
    }).catch(() => {
      // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±
      const textArea = document.createElement('textarea');
      textArea.value = url;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
    });
  }
}

// –°–≤—è–∑–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ WhatsApp
function contactWhatsApp() {
  const message = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ú–µ–Ω—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –æ–±—ä–µ–∫—Ç #${propertyId} - {{ property.title|e }}. –ú–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é?`;
  const whatsappUrl = `https://wa.me/66982649201?text=${encodeURIComponent(message)}`;
  window.open(whatsappUrl, '_blank');
}

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
  // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const existing = document.querySelectorAll('.notification-toast');
  existing.forEach(el => el.remove());
  
  const notification = document.createElement('div');
  notification.className = `notification-toast fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300 transform translate-x-full`;
  
  const colors = {
    success: 'bg-green-600',
    error: 'bg-red-600',
    info: 'bg-blue-600'
  };
  
  notification.classList.add(colors[type] || colors.info);
  notification.textContent = message;
  
  document.body.appendChild(notification);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    notification.style.transform = 'translateX(100%)';
    setTimeout(() => {
      if (document.body.contains(notification)) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 4000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Swiper —Å–ª–∞–π–¥–µ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
{% if property.images %}
document.addEventListener('DOMContentLoaded', function() {
  const swiper = new Swiper('.swiper', {
    loop: true,
    autoplay: {
      delay: 5000,
      disableOnInteraction: false,
    },
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
  });
});
{% endif %}
</script>
{% endblock %}
